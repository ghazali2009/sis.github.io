<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIS Construction Management System</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #f4f4f4;
            font-family: 'Roboto', sans-serif;
        }

        .container {
            margin-top: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }

        .dark-mode .container {
            background-color: #1e1e1e;
        }

        .button-group {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .chart-container {
            height: 400px;
        }
    </style>
</head>
<body>
    <div class="container" id="loginContainer">
        <h2 class="text-center">Login</h2>
        <input type="text" id="loginUsername" class="form-control mt-3" placeholder="Enter username">
        <input type="password" id="loginPassword" class="form-control mt-3" placeholder="Enter password">
        <button class="btn btn-primary mt-4 w-100" onclick="login()">Login</button>
    </div>

    <div class="container" id="mainContent" style="display:none;">
        <div class="button-group">
            <button class="btn btn-secondary" onclick="toggleDarkMode()">Toggle Dark Mode</button>
            <button class="btn btn-danger" onclick="logout()">Logout</button>
            <button class="btn btn-success" onclick="backupDatabase()">Backup Database</button>
            <button class="btn btn-warning" onclick="restoreDatabase()">Restore Database</button>
        </div>

        <ul class="nav nav-tabs mt-3" id="mainTabs">
            <li class="nav-item">
                <a class="nav-link active" href="#" onclick="showMainTab('expenseDashboard', this)">Expense Dashboard</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showMainTab('fundsDashboard', this)">Funds Dashboard</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showMainTab('balanceStatement', this)">Balance Statement</a>
            </li>
        </ul>

        <div id="expenseDashboardContent" class="mt-3">
            <h3>Expense Entry</h3>
            <div class="row">
                <div class="col-md-3">
                    <input type="text" id="description" class="form-control" placeholder="Description">
                </div>
                <div class="col-md-2">
                    <input type="number" id="amount" class="form-control" placeholder="Amount">
                </div>
                <div class="col-md-2">
                    <input type="date" id="date" class="form-control">
                </div>
                <div class="col-md-2">
                    <select id="category" class="form-control">
                        <option value="Loans Given">Loans Given</option>
                        <option value="Advances to Suppliers">Advances to Suppliers</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-primary w-100" onclick="addExpense()">Add Expense</button>
                </div>
            </div>

            <div class="chart-container mt-4">
                <canvas id="expenseChart"></canvas>
            </div>
        </div>

        <div id="fundsDashboardContent" class="mt-3" style="display:none;">
            <h3>Funds Entry</h3>
            <div class="row">
                <div class="col-md-3">
                    <input type="text" id="fundsDescription" class="form-control" placeholder="Description">
                </div>
                <div class="col-md-2">
                    <input type="number" id="fundsAmount" class="form-control" placeholder="Amount">
                </div>
                <div class="col-md-2">
                    <input type="date" id="fundsDate" class="form-control">
                </div>
                <div class="col-md-2">
                    <select id="fundsCategory" class="form-control">
                        <option value="Loan Repayments">Loan Repayments</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-primary w-100" onclick="addFunds()">Add Funds</button>
                </div>
            </div>

            <div class="chart-container mt-4">
                <canvas id="fundsChart"></canvas>
            </div>
        </div>

        <div id="balanceStatementContent" class="mt-3" style="display:none;">
            <h3>Balance Statement</h3>
            <div class="chart-container mt-4">
                <canvas id="balanceChart"></canvas>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const GITHUB_API_KEY = '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';
        const GITHUB_USERNAME = 'ghazali2009';
        const REPO_NAME = 'construction-data';
        const BRANCH = 'main';

        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
        let funds = JSON.parse(localStorage.getItem('funds')) || [];

        async function uploadData(filename, data) {
            const url = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${filename}`;
            const content = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
            await fetch(url, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${GITHUB_API_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ message: `Upload ${filename}`, content, branch: BRANCH })
            });
        }

        async function fetchData(filename) {
            const url = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${filename}?ref=${BRANCH}`;
            const response = await fetch(url, { headers: { 'Authorization': `token ${GITHUB_API_KEY}` } });
            const data = await response.json();
            return JSON.parse(atob(data.content));
        }

        function addExpense() {
            const description = document.getElementById('description').value;
            const amount = parseFloat(document.getElementById('amount').value);
            expenses.push({ description, amount });
            localStorage.setItem('expenses', JSON.stringify(expenses));
            updateExpenseChart();
        }

        function addFunds() {
            const description = document.getElementById('fundsDescription').value;
            const amount = parseFloat(document.getElementById('fundsAmount').value);
            funds.push({ description, amount });
            localStorage.setItem('funds', JSON.stringify(funds));
            updateFundsChart();
        }

        function updateExpenseChart() {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: expenses.map(e => e.description),
                    datasets: [{ data: expenses.map(e => e.amount) }]
                }
            });
        }

        function updateFundsChart() {
            const ctx = document.getElementById('fundsChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: funds.map(f => f.description),
                    datasets: [{ data: funds.map(f => f.amount) }]
                }
            });
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }

        function showMainTab(tab, element) {
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            document.getElementById('expenseDashboardContent').style.display = tab === 'expenseDashboard' ? 'block' : 'none';
            document.getElementById('fundsDashboardContent').style.display = tab === 'fundsDashboard' ? 'block' : 'none';
            document.getElementById('balanceStatementContent').style.display = tab === 'balanceStatement' ? 'block' : 'none';
        }
    </script>
</body>
</html>
