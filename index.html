<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIS Construction Management System</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #f4f4f4;
            font-family: 'Roboto', sans-serif;
        }

        .container {
            margin-top: 20px;
            background: white;
            padding: 20px 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .button-group {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-bottom: 20px;
        }

        .dark-mode {
            background-color: #121212 !important;
            color: #e0e0e0 !important;
        }

        .dark-mode .container {
            background-color: #1e1e1e;
        }

        .summary-table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }

        .summary-table th,
        .summary-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        .summary-table th {
            background-color: #0d6efd;
            color: white;
        }
    </style>
</head>

<body>
    <div id="loginContainer">
        <h2 class="text-center">Login</h2>
        <input type="text" id="loginUsername" class="form-control mt-3" placeholder="Enter username">
        <input type="password" id="loginPassword" class="form-control mt-3" placeholder="Enter password">
        <button class="btn btn-primary mt-4 w-100" onclick="login()">Login</button>
    </div>

    <div class="container" id="mainContent" style="display: none;">
        <div class="button-group">
            <button class="btn btn-secondary" onclick="toggleDarkMode()">Toggle Dark Mode</button>
            <button class="btn btn-danger" onclick="logout()">Logout</button>
            <button class="btn btn-success" onclick="backupDatabase()">Backup Database</button>
            <button class="btn btn-warning" onclick="restoreDatabase()">Restore Database</button>
        </div>

        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link active" href="#" onclick="showMainTab('expenseDashboard', this)">Expense Dashboard</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showMainTab('fundsDashboard', this)">Funds Dashboard</a>
            </li>
        </ul>

        <div id="expenseDashboardContent">
            <h3>Expense Entry</h3>
            <input type="text" id="description" class="form-control mt-3" placeholder="Description">
            <input type="number" id="amount" class="form-control mt-3" placeholder="Amount">
            <button class="btn btn-primary mt-3" onclick="addExpense()">Add Expense</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.13/jspdf.plugin.autotable.min.js"></script>
    <script>
        const GITHUB_API_KEY = "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";
        const GITHUB_USERNAME = "ghazali2009";
        const REPO_NAME = "construction-data";
        const BRANCH = "main";

        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];

        async function uploadDataToGitHub(filename, data) {
            const url = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${filename}`;
            const content = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
            const body = { message: `Upload ${filename}`, content, branch: BRANCH };

            await fetch(url, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${GITHUB_API_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            });
        }

        async function retrieveDataFromGitHub(filename) {
            const url = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${filename}?ref=${BRANCH}`;
            const response = await fetch(url, {
                headers: { 'Authorization': `token ${GITHUB_API_KEY}` }
            });
            const data = await response.json();
            return JSON.parse(atob(data.content));
        }

        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            if (username === "admin" && password === "password123") {
                localStorage.setItem('loggedIn', 'true');
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
            } else {
                alert("Invalid credentials");
            }
        }

        function logout() {
            localStorage.setItem('loggedIn', 'false');
            location.reload();
        }

        async function backupDatabase() {
            await uploadDataToGitHub("expenses.json", expenses);
            alert("Backup completed");
        }

        async function restoreDatabase() {
            expenses = await retrieveDataFromGitHub("expenses.json");
            localStorage.setItem('expenses', JSON.stringify(expenses));
            alert("Data restored");
        }

        function addExpense() {
            const description = document.getElementById('description').value;
            const amount = parseFloat(document.getElementById('amount').value);
            expenses.push({ description, amount });
            localStorage.setItem('expenses', JSON.stringify(expenses));
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }

        function showMainTab(tabName, element) {
            document.querySelectorAll('.nav-link').forEach(tab => tab.classList.remove('active'));
            element.classList.add('active');

            document.getElementById('expenseDashboardContent').style.display = tabName === 'expenseDashboard' ? 'block' : 'none';
        }
    </script>
</body>

</html>
